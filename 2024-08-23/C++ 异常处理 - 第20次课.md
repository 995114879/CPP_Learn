# C++ 异常处理 - 第20次课 

## **第一部分: 异常概述 6**

* **1.1 什么是异常?**
    * 程序运行过程中出现的错误或意外情况。
    * 举例: 除零错误，内存分配失败，文件打开失败等。
    * 传统的错误处理方式 (返回值判断) 的局限性.

* **1.2 异常处理的优势:**
    * 将错误处理代码与正常逻辑代码分离，提高代码可读性和维护性.
    * 提供更灵活和强大的错误处理机制，可以跨函数甚至跨模块传递错误信息.
    * 避免程序崩溃，提高程序的健壮性.

**代码示例 (传统的错误处理方式):**

```c++
#include <iostream>

int divide(int a, int b) {
  if (b == 0) {
    return -1; // 用返回值表示错误
  }
  return a / b;
}

int main() {
  int result = divide(10, 0);
  if (result == -1) {
    std::cout << "Error: Division by zero!" << std::endl;
  } else {
    std::cout << "Result: " << result << std::endl;
  }
  return 0;
}
```

## **第二部分: 异常处理机制 9**

* **2.1 try, catch, throw 关键字:**
    * `try` 块: 包含可能抛出异常的代码.
    * `catch` 块: 捕获并处理特定类型的异常.
    * `throw` 关键字: 抛出异常对象.

* **2.2 异常类型:**
    * 内置异常类型 (例如: `std::runtime_error`, `std::logic_error`, `std::bad_alloc` 等).
    * 自定义异常类型.

* **2.3 异常处理流程:**
    * 程序执行到 `try` 块中抛出异常.
    * 查找匹配的 `catch` 块.
    * 执行 `catch` 块中的代码.
    * 如果没有找到匹配的 `catch` 块，程序终止.

**代码示例 (使用异常处理机制):**

```c++
#include <iostream>
#include <stdexcept>

int divide(int a, int b) {
  if (b == 0) {
    throw std::runtime_error("Error: Division by zero!");
  }
  return a / b;
}

int main() {
  try {
    int result = divide(10, 0);
    std::cout << "Result: " << result << std::endl;
  } catch (const std::runtime_error& e) {
    std::cout << e.what() << std::endl;
  }
  return 0;
}
```

## **第三部分: 自定义异常类型 6**

* **3.1 继承 `std::exception` 类.**
* **3.2 重写 `what()` 函数.**

**代码示例 (自定义异常类型):**

```c++
#include <iostream>
#include <exception>

class MyException : public std::exception {
public:
  const char* what() const noexcept override {
    return "My custom exception occurred!";
  }
};

int main() {
  try {
    throw MyException();
  } catch (const MyException& e) {
    std::cout << e.what() << std::endl;
  }
  return 0;
}
```

**第四部分: 异常处理的最佳实践 3**

* **4.1 尽量使用特定类型的异常.**
* **4.2 不要过度使用异常.**
* **4.3 确保在析构函数中不抛出异常.**
* **4.4 使用 `noexcept` 声明不抛出异常的函数.**

## **课后作业:**

编写一个程序，模拟银行账户操作，包括存款、取款等功能。使用异常处理机制来处理以下情况:

* 取款金额超过余额.
* 存款金额为负数.


**作业提示:**

* 定义一个 `BankAccount` 类，包含 `balance` 成员变量.
* 定义 `deposit` 和 `withdraw` 成员函数，分别用于存款和取款.
* 在 `withdraw` 函数中，如果取款金额超过余额，则抛出一个自定义异常 `InsufficientFundsException`.
* 在 `deposit` 函数中，如果存款金额为负数，则抛出一个自定义异常 `InvalidDepositAmountException`.
* 在 `main` 函数中，使用 `try-catch` 块来处理这些异常.
